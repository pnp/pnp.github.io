!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):t(e.$)}(this,function(e){"use strict";function o(e){return"%"==e[e.length-1]}function d(e){var t=e.split(" ");if(1!==t.length)return t.map(function(t){switch(e){case"center":return"50%";case"top":case"left":return"0";case"right":case"bottom":return"100%";default:return t}});switch(e){case"center":return["50%","50%"];case"top":return["50%","0"];case"bottom":return["50%","100%"];case"left":return["0","50%"];case"right":return["100%","50%"];default:return[e,"50%"]}}function a(e,n){function a(e,n){var s=t.createShader(e);if(t.shaderSource(s,n),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error("compile error: "+t.getShaderInfoLog(s));return s}if(o={},o.id=t.createProgram(),t.attachShader(o.id,a(t.VERTEX_SHADER,e)),t.attachShader(o.id,a(t.FRAGMENT_SHADER,n)),t.linkProgram(o.id),!t.getProgramParameter(o.id,t.LINK_STATUS))throw new Error("link error: "+t.getProgramInfoLog(o.id));o.uniforms={},o.locations={},t.useProgram(o.id),t.enableVertexAttribArray(0);for(var o,i,r,c=/uniform (\w+) (\w+)/g,l=e+n;null!=(r=c.exec(l));)i=r[2],o.locations[i]=t.getUniformLocation(o.id,i);return o}function i(e,n){t.activeTexture(t.TEXTURE0+(n||0)),t.bindTexture(t.TEXTURE_2D,e)}function r(e){var t=/url\(["']?([^"']*)["']?\)/.exec(e);return t==null?null:t[1]}function u(e){return e.match(/^data:/)}var t,n,l,c=(e=e&&"default"in e?e.default:e)(window),s=function(){function a(t,n,s){var o="OES_texture_"+t,i=o+"_linear",a=i in e,r=[o];return a&&r.push(i),{type:n,arrayType:s,linearSupport:a,extensions:r}}if(o=document.createElement("canvas"),!(t=o.getContext("webgl")||o.getContext("experimental-webgl")))return null;if(e={},["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear"].forEach(function(n){var s=t.getExtension(n);s&&(e[n]=s)}),!e.OES_texture_float)return null;n=[],n.push(a("float",t.FLOAT,Float32Array)),e.OES_texture_half_float&&n.push(a("half_float",e.OES_texture_half_float.HALF_FLOAT_OES,null));var e,n,s,o,i,r=t.createTexture(),c=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,c),t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);for(i=null,s=0;s<n.length;s++)if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,32,32,0,t.RGBA,n[s].type,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE){i=n[s];break}return i}(),h=function(e,t){try{return new ImageData(e,t)}catch{return document.createElement("canvas").getContext("2d").createImageData(e,t)}}(32,32);e("head").prepend("<style>.jquery-ripples { position: relative; z-index: 0; }</style>"),n=function(n,o){function l(){r.destroyed||(r.step(),requestAnimationFrame(l))}r=this,this.$el=e(n),this.interactive=o.interactive,this.resolution=o.resolution,this.textureDelta=new Float32Array([1/this.resolution,1/this.resolution]),this.perturbance=o.perturbance,this.dropRadius=o.dropRadius,this.crossOrigin=o.crossOrigin,this.imageUrl=o.imageUrl,i=document.createElement("canvas"),i.width=this.$el.innerWidth(),i.height=this.$el.innerHeight(),this.canvas=i,this.$canvas=e(i),this.$canvas.css({position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:-1}),this.$el.addClass("jquery-ripples").append(i),this.context=t=i.getContext("webgl")||i.getContext("experimental-webgl"),s.extensions.forEach(function(e){t.getExtension(e)}),this.updateSize=this.updateSize.bind(this),e(window).on("resize",this.updateSize),this.textures=[],this.framebuffers=[],this.bufferWriteIndex=0,this.bufferReadIndex=1;for(var i,a,r,c,d=s.arrayType,h=d?new d(this.resolution*this.resolution*4):null,u=0;u<2;u++)a=t.createTexture(),c=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,c),t.bindTexture(t.TEXTURE_2D,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,s.linearSupport?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,s.linearSupport?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.resolution,this.resolution,0,t.RGBA,s.type,h),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0),this.textures.push(a),this.framebuffers.push(c);this.quad=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quad),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),t.STATIC_DRAW),this.initShaders(),this.initTexture(),this.setTransparentTexture(),this.loadImage(),t.clearColor(0,0,0,0),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.visible=!0,this.running=!0,this.inited=!0,this.destroyed=!1,this.setupPointerEvents(),requestAnimationFrame(l)},n.DEFAULTS={imageUrl:null,resolution:256,dropRadius:20,perturbance:.03,interactive:!0,crossOrigin:""},n.prototype={setupPointerEvents:function(){function n(){return e.visible&&e.running&&e.interactive}function t(t,s){n()&&e.dropAtPointer(t,e.dropRadius*(s?1.5:1),s?.14:.01)}var e=this;this.$el.on("mousemove.ripples",function(e){t(e)}).on("touchmove.ripples touchstart.ripples",function(e){for(var s=e.originalEvent.changedTouches,n=0;n<s.length;n++)t(s[n])}).on("mousedown.ripples",function(e){t(e,!0)})},loadImage:function(){var e,s,n=this;t=this.context,s=this.imageUrl||r(this.originalCssBackgroundImage)||r(this.$el.css("backgroundImage")),s!=this.imageSource&&(this.imageSource=s,this.imageSource?(e=new Image,e.onload=function(){function s(e){return 0==(e&e-1)}t=n.context;var o=s(e.width)&&s(e.height)?t.REPEAT:t.CLAMP_TO_EDGE;t.bindTexture(t.TEXTURE_2D,n.backgroundTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),n.backgroundWidth=e.width,n.backgroundHeight=e.height,n.hideCssBackground()},e.onerror=function(){t=n.context,n.setTransparentTexture()},e.crossOrigin=u(this.imageSource)?null:this.crossOrigin,e.src=this.imageSource):this.setTransparentTexture())},step:function(){t=this.context,this.visible&&(this.computeTextureBoundaries(),this.running&&this.update(),this.render())},drawQuad:function(){t.bindBuffer(t.ARRAY_BUFFER,this.quad),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_FAN,0,4)},render:function(){t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.canvas.width,this.canvas.height),t.enable(t.BLEND),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.useProgram(this.renderProgram.id),i(this.backgroundTexture,0),i(this.textures[0],1),t.uniform1f(this.renderProgram.locations.perturbance,this.perturbance),t.uniform2fv(this.renderProgram.locations.topLeft,this.renderProgram.uniforms.topLeft),t.uniform2fv(this.renderProgram.locations.bottomRight,this.renderProgram.uniforms.bottomRight),t.uniform2fv(this.renderProgram.locations.containerRatio,this.renderProgram.uniforms.containerRatio),t.uniform1i(this.renderProgram.locations.samplerBackground,0),t.uniform1i(this.renderProgram.locations.samplerRipples,1),this.drawQuad(),t.disable(t.BLEND)},update:function(){t.viewport(0,0,this.resolution,this.resolution),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),i(this.textures[this.bufferReadIndex]),t.useProgram(this.updateProgram.id),this.drawQuad(),this.swapBufferIndices()},swapBufferIndices:function(){this.bufferWriteIndex=1-this.bufferWriteIndex,this.bufferReadIndex=1-this.bufferReadIndex},computeTextureBoundaries:function(){var e,t,n,s,i,l,u,a=this.$el.css("background-size"),m=this.$el.css("background-attachment"),h=d(this.$el.css("background-position"));if("fixed"==m?((n={left:window.pageXOffset,top:window.pageYOffset}).width=c.width(),n.height=c.height()):((n=this.$el.offset()).width=this.$el.innerWidth(),n.height=this.$el.innerHeight()),"cover"==a)var r=Math.max(n.width/this.backgroundWidth,n.height/this.backgroundHeight),e=this.backgroundWidth*r,t=this.backgroundHeight*r;else if("contain"==a)var r=Math.min(n.width/this.backgroundWidth,n.height/this.backgroundHeight),e=this.backgroundWidth*r,t=this.backgroundHeight*r;else e=(a=a.split(" "))[0]||"",t=a[1]||e,o(e)?e=n.width*parseFloat(e)/100:"auto"!=e&&(e=parseFloat(e)),o(t)?t=n.height*parseFloat(t)/100:"auto"!=t&&(t=parseFloat(t)),"auto"==e&&"auto"==t?(e=this.backgroundWidth,t=this.backgroundHeight):("auto"==e&&(e=this.backgroundWidth*(t/this.backgroundHeight)),"auto"==t&&(t=this.backgroundHeight*(e/this.backgroundWidth)));s=h[0],i=h[1],s=o(s)?n.left+(n.width-e)*parseFloat(s)/100:n.left+parseFloat(s),i=o(i)?n.top+(n.height-t)*parseFloat(i)/100:n.top+parseFloat(i),l=this.$el.offset(),this.renderProgram.uniforms.topLeft=new Float32Array([(l.left-s)/e,(l.top-i)/t]),this.renderProgram.uniforms.bottomRight=new Float32Array([this.renderProgram.uniforms.topLeft[0]+this.$el.innerWidth()/e,this.renderProgram.uniforms.topLeft[1]+this.$el.innerHeight()/t]),u=Math.max(this.canvas.width,this.canvas.height),this.renderProgram.uniforms.containerRatio=new Float32Array([this.canvas.width/u,this.canvas.height/u])},initShaders:function(){var e=["attribute vec2 vertex;","varying vec2 coord;","void main() {","coord = vertex * 0.5 + 0.5;","gl_Position = vec4(vertex, 0.0, 1.0);","}"].join(`
`);this.dropProgram=a(e,["precision highp float;","const float PI = 3.141592653589793;","uniform sampler2D texture;","uniform vec2 center;","uniform float radius;","uniform float strength;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);","drop = 0.5 - cos(drop * PI) * 0.5;","info.r += drop * strength;","gl_FragColor = info;","}"].join(`
`)),this.updateProgram=a(e,["precision highp float;","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 coord;","void main() {","vec4 info = texture2D(texture, coord);","vec2 dx = vec2(delta.x, 0.0);","vec2 dy = vec2(0.0, delta.y);","float average = (","texture2D(texture, coord - dx).r +","texture2D(texture, coord - dy).r +","texture2D(texture, coord + dx).r +","texture2D(texture, coord + dy).r",") * 0.25;","info.g += (average - info.r) * 2.0;","info.g *= 0.995;","info.r += info.g;","gl_FragColor = info;","}"].join(`
`)),t.uniform2fv(this.updateProgram.locations.delta,this.textureDelta),this.renderProgram=a(["precision highp float;","attribute vec2 vertex;","uniform vec2 topLeft;","uniform vec2 bottomRight;","uniform vec2 containerRatio;","varying vec2 ripplesCoord;","varying vec2 backgroundCoord;","void main() {","backgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);","backgroundCoord.y = 1.0 - backgroundCoord.y;","ripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;","gl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);","}"].join(`
`),["precision highp float;","uniform sampler2D samplerBackground;","uniform sampler2D samplerRipples;","uniform vec2 delta;","uniform float perturbance;","varying vec2 ripplesCoord;","varying vec2 backgroundCoord;","void main() {","float height = texture2D(samplerRipples, ripplesCoord).r;","float heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;","float heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;","vec3 dx = vec3(delta.x, heightX - height, 0.0);","vec3 dy = vec3(0.0, heightY - height, delta.y);","vec2 offset = -normalize(cross(dy, dx)).xz;","float specular = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 4.0);","gl_FragColor = texture2D(samplerBackground, backgroundCoord + offset * perturbance) + specular;","}"].join(`
`)),t.uniform2fv(this.renderProgram.locations.delta,this.textureDelta)},initTexture:function(){this.backgroundTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.backgroundTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)},setTransparentTexture:function(){t.bindTexture(t.TEXTURE_2D,this.backgroundTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,h)},hideCssBackground:function(){var e=this.$el[0].style.backgroundImage;"none"!=e&&(this.originalInlineCss=e,this.originalCssBackgroundImage=this.$el.css("backgroundImage"),this.$el.css("backgroundImage","none"))},restoreCssBackground:function(){this.$el.css("backgroundImage",this.originalInlineCss||"")},dropAtPointer:function(e,t,n){var s=parseInt(this.$el.css("border-left-width"))||0,o=parseInt(this.$el.css("border-top-width"))||0;this.drop(e.pageX-this.$el.offset().left-s,e.pageY-this.$el.offset().top-o,t,n)},drop:function(e,n,s,o){t=this.context;var l,r=this.$el.innerWidth(),c=this.$el.innerHeight(),a=Math.max(r,c);s/=a,l=new Float32Array([(2*e-r)/a,(c-2*n)/a]),t.viewport(0,0,this.resolution,this.resolution),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),i(this.textures[this.bufferReadIndex]),t.useProgram(this.dropProgram.id),t.uniform2fv(this.dropProgram.locations.center,l),t.uniform1f(this.dropProgram.locations.radius,s),t.uniform1f(this.dropProgram.locations.strength,o),this.drawQuad(),this.swapBufferIndices()},updateSize:function(){var e=this.$el.innerWidth(),t=this.$el.innerHeight();e==this.canvas.width&&t==this.canvas.height||(this.canvas.width=e,this.canvas.height=t)},destroy:function(){this.$el.off(".ripples").removeClass("jquery-ripples").removeData("ripples"),t=null,e(window).off("resize",this.updateSize),this.$canvas.remove(),this.restoreCssBackground(),this.destroyed=!0},show:function(){this.visible=!0,this.$canvas.show(),this.hideCssBackground()},hide:function(){this.visible=!1,this.$canvas.hide(),this.restoreCssBackground()},pause:function(){this.running=!1},play:function(){this.running=!0},set:function(e,t){switch(e){case"dropRadius":case"perturbance":case"interactive":case"crossOrigin":this[e]=t;break;case"imageUrl":this.imageUrl=t,this.loadImage()}}},l=e.fn.ripples,e.fn.ripples=function(t){if(!s)throw new Error("Your browser does not support WebGL, the OES_texture_float extension or rendering to floating point textures.");var o=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var i=e(this),s=i.data("ripples"),a=e.extend({},n.DEFAULTS,i.data(),"object"==typeof t&&t);(s||"string"!=typeof t)&&(s?"string"==typeof t&&n.prototype[t].apply(s,o):i.data("ripples",s=new n(this,a)))})},e.fn.ripples.Constructor=n,e.fn.ripples.noConflict=function(){return e.fn.ripples=l,this}})